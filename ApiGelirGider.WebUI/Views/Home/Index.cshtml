@using System.Globalization
@model ApiGelirGider.WebUI.Models.DashboardViewModel

@{
    ViewData["Title"] = "Home Page";
}

<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
</div>

<!-- Top Cards Row -->
<div class="row">

    <!-- Toplam Gelir -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                            Toplam Gelir
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            @Model.TotalIncome.ToString("N2") ₺
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-wallet fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toplam Gider -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-danger shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                            Toplam Gider
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                            @Model.TotalExpense.ToString("N2") ₺
                        </div>
                    </div>
                    <div class="col-auto">
                        <i class="fas fa-receipt fa-2x text-gray-300"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gelir Yüzdesi (Monthly) -->
    @* İstersen burayı aylık gelir yüzdesiyle doldurabilirsin *@
    <div class="col-xl-3 col-md-6 mb-4">
        @{
            var gelir = Model.TotalIncome;
            var gider = Model.TotalExpense;
            var toplam = gelir + gider;
            double gelirYuzde = toplam > 0
            ? (double)gelir * 100d / (double)toplam
            : 0d;
        }
        <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                    Gelir Oranı
                </div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">
                    @gelirYuzde.ToString("0.##", CultureInfo.InvariantCulture)%
                </div>
            </div>
        </div>
    </div>

    <!-- Gider Yüzdesi (Monthly) -->
    <div class="col-xl-3 col-md-6 mb-4">
        @{
            double giderYuzde = (Model.TotalIncome + Model.TotalExpense) > 0
            ? (double)Model.TotalExpense * 100d / (double)(Model.TotalIncome + Model.TotalExpense)
            : 0d;
        }
        <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                    Gider Oranı
                </div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">
                    @giderYuzde.ToString("0.##", CultureInfo.InvariantCulture)%
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Charts Row -->
<div class="row">

    <!-- Area Chart Placeholder -->
    <div class="col-xl-8 col-lg-7">
        <div class="card shadow mb-4">
            <!-- Card Header -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Earnings Overview</h6>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <div class="chart-area">
                    <canvas id="myAreaChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Gelir-Gider Oranı Card -->
    <div class="col-xl-4 col-lg-5">
        <div class="card shadow mb-4">
            <!-- Card Header -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Gelir – Gider Dağılımı</h6>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                @* Sunucu tarafında yüzde hesaplamaları *@
                @{
                   
                    double gelirYuzde2 = toplam > 0
                    ? (double)gelir * 100d / (double)toplam
                    : 0d;
                    double giderYuzde2 = toplam > 0
                    ? (double)gider * 100d / (double)toplam
                    : 0d;

                    string gelirWidth = gelirYuzde2
                    .ToString("0.##", CultureInfo.InvariantCulture) + "%";
                    string giderWidth = giderYuzde2
                    .ToString("0.##", CultureInfo.InvariantCulture) + "%";
                }

                <!-- Grafik Barı -->
                <div class="position-relative w-100" style="
                        height: 30px;
                        background-color: #eee;
                        border-radius: 8px;
                        overflow: hidden;
                    ">
                    <!-- Gelir Dilimi -->
                    <div class="position-absolute top-0 start-0 h-100 d-flex align-items-center justify-content-center text-white fw-bold"
                         style="
                            width: @gelirWidth;
                            background-color: #4CAF50;
                            font-size: 0.8rem;
                         ">
                        @gelirYuzde2.ToString("0.##", CultureInfo.InvariantCulture)%
                    </div>

                    <!-- Gider Dilimi -->
                    <div class="position-absolute top-0"
                         style="
                            left: @gelirWidth;
                            width: @giderWidth;
                            height: 100%;
                            background-color: #F44336;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: white;
                            font-size: 0.8rem;
                            font-weight: bold;
                         ">
                        @giderYuzde2.ToString("0.##", CultureInfo.InvariantCulture)%
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<div class="container-fluid">
    <!-- Top Cards Row -->
    <div class="row mb-4">
        
    <!-- Charts Row -->
    <div class="row mb-4">
                        <!-- Gelir Dilimi -->
                        <div class="position-absolute top-0 start-0 h-100 d-flex align-items-center justify-content-center text-white fw-bold"
                             style="
                                width: @($"{gelirYuzde.ToString("0.##", CultureInfo.InvariantCulture)}%");
                                background-color: #4CAF50;
                                font-size: 0.8rem;
                             ">
                            @gelirYuzde.ToString("0.##", CultureInfo.InvariantCulture)%
                        </div>

                       
    <!-- Alt Kısımda Sayısal Gösterim -->
    <div class="mb-4">
        <p><strong>Gelir:</strong> @gelir.ToString("N2") ₺ (@gelirYuzde.ToString("0.##", CultureInfo.InvariantCulture)%)</p>
        <p><strong>Gider:</strong> @gider.ToString("N2") ₺ (@giderYuzde.ToString("0.##", CultureInfo.InvariantCulture)%)</p>
    </div>

    <!-- Content Row -->
    <div class="row">

        <!-- Son 5 Gider -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #4b6cb7, #182848);">
                    <h5 class="mb-0">💸 Son 5 Gider</h5>
                </div>
                <div class="card-body">
                    @if (Model.LastExpenses?.Any() == true)
                    {
                        <div class="table-responsive">
                            <table class="table table-striped align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="text-start">💰 Tutar (₺)</th>
                                        <th class="text-center">📅 Tarih</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.LastExpenses)
                                    {
                                        <tr>
                                            <td class="text-start text-danger fw-bold">
                                                @item.ExpenseAmount.ToString("N2")
                                            </td>
                                            <td class="text-center">
                                                @item.ExpenseDate.ToString("dd MMM yyyy")
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info text-center mb-0">
                            <i class="bi bi-info-circle me-2"></i> Henüz gider verisi bulunamadı.
                        </div>
                    }
                </div>
            </div>

            <!-- Color System (Placeholder) -->
            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="card bg-primary text-white shadow">
                        <div class="card-body">
                            Primary
                            <div class="text-white-50 small">#4e73df</div>
                        </div>
                    </div>
                </div>
                <!-- Diğer renk kartlarını buraya ekleyebilirsin -->
            </div>
        </div>

        <!-- Son 5 Gelir -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #4b6cb7, #182848);">
                    <h5 class="mb-0">💸 Son 5 Gelir</h5>
                </div>
                <div class="card-body">
                    @if (Model.LastIncomes?.Any() == true)
                    {
                        <div class="table-responsive">
                            <table class="table table-striped align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="text-start">💰 Tutar (₺)</th>
                                        <th class="text-center">📅 Tarih</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.LastIncomes)
                                    {
                                        <tr>
                                            <td class="text-start text-success fw-bold">
                                                @item.IncomeAmount.ToString("N2")
                                            </td>
                                            <td class="text-center">
                                                @item.IncomeDate.ToString("dd MMM yyyy")
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-info text-center mb-0">
                            <i class="bi bi-info-circle me-2"></i> Henüz gelir verisi bulunamadı.
                        </div>
                    }
                </div>
            </div>

            <!-- Development Approach (Placeholder) -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Development Approach</h6>
                </div>
                <div class="card-body">
                    <p>
                                Bu dashboard uygulaması, gerçek zamanlı olarak gelir ve gider verilerinizi
                                takip etmenize ve finansal durumunuzu hızlıca analiz etmenize olanak tanır.
                                ASP.NET Core MVC ile geliştirilmiş Web API’ler üzerinden veri çekilir,
                                Entity Framework Core ile veritabanı yönetimi sağlanır ve Bootstrap 5
                                ile duyarlı bir kullanıcı arayüzü sunulur.
                    </p>
                    <p class="mb-0">
                                Grafiksel gösterimler sunucu tarafında ScottPlot kütüphanesi ile
                                render edilirken, tablo ve kart bileşenleri tamamen Razor ve CSS
                                ile oluşturulmuştur. Böylece JavaScript’e bağımlı kalmadan
                                estetik ve performanslı bir deneyim elde edilir.
                    </p>
                </div>
            </div>
        </div>

    </div>
</div>
